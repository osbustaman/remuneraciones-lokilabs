<form method="post" id="form-forescat-data" name="form-forescat-data" action="{% url 'usuario_app:add_forecast_data' id col_id %}">
    {% csrf_token %}

    <div class="form-layout">
        <div class="row mg-b-25">
            <div class="col-lg-2">
                <div class="form-group">
                    <label class="form-control-label">{{ formFormsForecastData.afp.label }} <span
                            class="tx-danger">*</span></label> {{ formFormsForecastData.afp }}
                </div>
            </div>
            <!-- col-4 -->
            <div class="col-lg-10">
                <br>
                <div class="alert alert-info" role="alert">
                    <small><strong class="d-block d-sm-inline-block-force">CÓDIGO PREVIRED: </strong> <span id="alert-afp">{{ usuario_empresa.afp.afp_codigoprevired }}</span>, </small>
                    <small><strong class="d-block d-sm-inline-block-force">PORCENTAJE: </strong> <span id="alert-afp-porcentaje">{{ usuario_empresa.afp.afp_tasatrabajadordependiente }}</span>%</small>
                </div>
                <!-- alert -->
            </div>
        </div>

        <div class="row mg-b-25">
            <div class="col-lg-2">
                <div class="form-group">
                    <label class="form-control-label">{{ formFormsForecastData.salud.label }} <span
                            class="tx-danger">*</span></label> {{ formFormsForecastData.salud }}
                </div>
            </div>
            <!-- col-4 -->
            <div class="col-lg-2">
                <div class="form-group">
                    <label class="form-control-label">{{ formFormsForecastData.ue_ufisapre.label }} <span
                            class="tx-danger"></span></label> {{ formFormsForecastData.ue_ufisapre }}
                </div>
            </div>
            <!-- col-4 -->
            <div class="col-lg-2">
                <div class="form-group">
                    <label class="form-control-label">{{ formFormsForecastData.ue_funisapre.label }} <span
                            class="tx-danger"></span></label> {{ formFormsForecastData.ue_funisapre }}
                </div>
            </div>
            <!-- col-4 -->
            <div class="col-lg-2">
                <div class="form-group">
                    <label class="form-control-label">{{ formFormsForecastData.ue_cotizacion.label }} <span
                            class="tx-danger"></span></label> {{ formFormsForecastData.ue_cotizacion }}
                </div>
            </div>
            <!-- col-4 -->
        </div>

        <div class="row mg-b-25">
            <div class="col-lg-2">
                <div class="form-group">
                    <label class="form-control-label">{{ formFormsForecastData.ue_tieneapv.label }} <span
                            class="tx-danger">*</span></label> {{ formFormsForecastData.ue_tieneapv }}
                </div>
            </div>
            <!-- col-4 -->
            <div class="col-lg-2">
                <div class="form-group">
                    <label class="form-control-label">{{ formFormsForecastData.apv.label }} <span
                            class="tx-danger"></span></label> {{ formFormsForecastData.apv }}
                </div>
            </div>
            <!-- col-4 -->
            <div class="col-lg-2">
                <div class="form-group">
                    <label class="form-control-label">{{ formFormsForecastData.ue_contributiontype.label }} <span
                            class="tx-danger"></span></label> {{ formFormsForecastData.ue_contributiontype }}
                </div>
            </div>
            <!-- col-4 -->

            <div class="col-lg-2">
                <div class="form-group">
                    <label class="form-control-label">{{ formFormsForecastData.ue_taxregime.label }} <span
                            class="tx-danger"></span></label> {{ formFormsForecastData.ue_taxregime }}
                </div>
            </div>
            <!-- col-4 -->
            <div class="col-lg-2">
                <div class="form-group">
                    <label class="form-control-label">{{ formFormsForecastData.ue_shape.label }} <span
                            class="tx-danger"></span></label> {{ formFormsForecastData.ue_shape }}
                </div>
            </div>
            <!-- col-4 -->
            <div class="col-lg-1">
                <div class="form-group">
                    <label class="form-control-label">{{ formFormsForecastData.ue_apvamount.label }} <span
                            class="tx-danger"></span></label> {{ formFormsForecastData.ue_apvamount }}
                </div>
            </div>
            <!-- col-4 -->
            <div class="col-lg-2">
                <div class="form-group">
                    <label class="form-control-label">{{ formFormsForecastData.ue_paymentperioddate.label }} <span
                            class="tx-danger"></span></label> {{ formFormsForecastData.ue_paymentperioddate }}
                </div>
            </div>
            <!-- col-4 -->
        </div>

        <div class="row mg-b-25">
            <div class="col-lg-4">
                <div class="form-group">
                    <label class="form-control-label">{{ formFormsForecastData.caja_compensacion.label }} <span
                            class="tx-danger">*</span></label> {{ formFormsForecastData.caja_compensacion }}
                </div>
            </div>
            <!-- col-4 -->
        </div>
        <!-- col-4 -->


        <div class="form-layout-footer mg-t-30">
            <button type="submit" class="btn btn-info mg-r-5">Guardar</button>
        </div>
        <!-- form-layout-footer -->
    </div>
</form>

{% if messages %} {% for message in messages %} {% if message.tags == 'error' %}
<div class="alert alert-danger mt-4" role="alert">
    {% else %}
    <div class="alert alert-success mt-4" role="alert">
        {% endif %}
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
        <div class="d-flex align-items-center justify-content-start">
            <i class="icon ion-ios-{% if message.tags == 'error' %}close{% else %}checkmark{% endif %} alert-icon tx-32 mg-t-5 mg-xs-t-0"></i>
            <span><strong>{% if message.tags == 'error' %}Error{% else %}Éxito{% endif %}: </strong> {{ message }}</span>
        </div>
        <!-- d-flex -->
    </div>
    <!-- alert -->
    {% endfor %} {% endif %}

    <script>
        $(document).ready(function() {

            $("#id_ue_ufisapre").val(0.0).attr("readonly", true);
            $("#id_ue_funisapre").attr("readonly", true);
            $("#id_ue_cotizacion").attr("readonly", true);

            $("#id_afp").change(function() {
                const endpoint = "{% url 'usuario_app:AfpDetailApiView' '__id__' %}".replace('__id__', this.value);

                axios.get(endpoint)
                    .then(response => {
                        const spanElement = document.getElementById('alert-afp');
                        const spanElementPorcentaje = document.getElementById('alert-afp-porcentaje');
                        spanElement.textContent = response.data[0]['afp_codigoprevired'];
                        spanElementPorcentaje.textContent = response.data[0]['afp_tasatrabajadorindependiente'];
                    })
                    .catch(error => {
                        console.error('Error en la solicitud:', error.message);
                    });
            })

            $("#id_salud").change(function() {
                if (this.value === '1') {
                    $("#id_ue_ufisapre, #id_ue_funisapre").prop("readonly", true);
                    $("#id_ue_cotizacion").val(7.0);
                    $("#id_ue_ufisapre").val(0.0);
                    $("#id_ue_funisapre").val(0);
                } else {
                    $("#id_ue_ufisapre, #id_ue_funisapre").prop("readonly", false);
                    $("#id_ue_cotizacion").val(0.0);
                }
            })

            let id_apv = $("#id_apv").val();
            let id_ue_contributiontype = $("#id_ue_contributiontype").val();
            let id_ue_taxregime = $("#id_ue_taxregime").val();
            let id_ue_shape = $("#id_ue_shape").val();
            let id_ue_apvamount = $("#id_ue_apvamount").val();
            let id_ue_paymentperioddate = $("#id_ue_paymentperioddate").val();

            let required = false
            if ($("#id_ue_tieneapv").val() === 'S') {
                required = true
            }

            $("#id_apv, #id_ue_contributiontype, #id_ue_taxregime, #id_ue_shape").attr("required", required);

            $("#id_ue_tieneapv").change(function() {

                if (this.value === 'S') {
                    $("#id_apv").val(id_apv).trigger('change');
                    $("#id_ue_contributiontype").val(id_ue_contributiontype).trigger('change');
                    $("#id_ue_taxregime").val(id_ue_taxregime).trigger('change');
                    $("#id_ue_shape").val(id_ue_shape).trigger('change');
                    $("#id_ue_apvamount").val(id_ue_apvamount);
                    $("#id_ue_paymentperioddate").val(id_ue_paymentperioddate);

                    $("#id_apv, #id_ue_contributiontype, #id_ue_taxregime, #id_ue_shape").attr("required", true);

                } else {
                    $("#id_apv").val('').trigger('change');
                    $("#id_ue_contributiontype").val('').trigger('change');
                    $("#id_ue_taxregime").val('').trigger('change');
                    $("#id_ue_shape").val('').trigger('change');
                    $("#id_ue_apvamount").val('');
                    $("#id_ue_paymentperioddate").val('');

                    $("#id_apv, #id_ue_contributiontype, #id_ue_taxregime, #id_ue_shape").attr("required", false);

                }
            })
        });
    </script>